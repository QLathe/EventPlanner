@{
    ViewData["Title"] = "Dashboard";
}
<a href="logout">logout</a>
<h1>THIS IS THE DASHBOARD</h1>
<p>
    (your created events, upcoming events you RSVPd to)
</p>


@{
  int Calstart = (int)ViewBag.StartCal.DayOfWeek;
  int day = 1;
  int nextmonth = 1;
}
<div class="container-fluid">
  <header>
    <h4 class="display-4 mb-4 text-center">@DateTime.Now.ToString("MMMMMMMMMMMMM") @DateTime.Now.Year</h4>
    <div class="row d-none d-sm-flex p-1 bg-dark text-white">
      <h5 class="col-sm p-1 text-center">Sunday</h5>
      <h5 class="col-sm p-1 text-center">Monday</h5>
      <h5 class="col-sm p-1 text-center">Tuesday</h5>
      <h5 class="col-sm p-1 text-center">Wednesday</h5>
      <h5 class="col-sm p-1 text-center">Thursday</h5>
      <h5 class="col-sm p-1 text-center">Friday</h5>
      <h5 class="col-sm p-1 text-center">Saturday</h5>
    </div>
  </header>

  @for (int i = 0; i < 5; i++)
  {
    if (i == 0)
    {
      <div class="row border border-right-0 border-bottom-0">
        
        @for(var x = 1; x<=Calstart;x++){
          DateTime thisDay = new DateTime(DateTime.Now.Year, DateTime.Now.Month-1,ViewBag.LastMonth-(Calstart-x));
          <div class ='day col-sm p-2 border border-left-0 border-top-0 text-truncate d-none d-sm-inline-block bg-light text-muted'>
          <h5 class="row align-items-center">
              <span class="date col-1">@(ViewBag.LastMonth-(Calstart-x))</span>
            <small class="col d-sm-none text-center text-muted">@thisDay.DayOfWeek</small>
            <span class="col-1"></span>
          </h5>
          @foreach (var vent in ViewBag.Events)
          {
              if(vent.ScheduledAt.Date == thisDay.Date){
                
                <p class="d-sm">@vent.Title</p>
              } else {

                <p class="d-sm-none">No events</p>
              }
          }
          </div> 
        }
        @for(var y = 1; y<=(7-Calstart); y++){
            DateTime thisDay = new DateTime(DateTime.Now.Year, DateTime.Now.Month,day);
        <div
          class="day col-sm p-2 border border-left-0 border-top-0 text-truncate">
          <h5 class="row align-items-center">
              <span class="date col-1">@day</span>
              @{day++;}
              <small class="col d-sm-none text-center text-muted">@thisDay.DayOfWeek</small>
            <span class="col-1"></span>
          </h5>
          @foreach (var vent in ViewBag.Events)
          {
              if(vent.ScheduledAt.Date == thisDay.Date){
                
                <p class="d-sm">@vent.Title</p>
              } else {

                <p class="d-sm-none">No events</p>
              }
          }
          </div>
        }
      </div>
    }
      <div class="row border border-right-0 border-bottom-0">
    @for(var week = 1; week<=7; week++){
    @if(day<=ViewBag.Month){
      DateTime thisDay = new DateTime(DateTime.Now.Year, DateTime.Now.Month,day);

      <div
        class="day col-sm p-2 border border-left-0 border-top-0 text-truncate">
        <h5 class="row align-items-center">
          <span class="date col-1">@day</span>
          @{day++;}
          <small class="col d-sm-none text-center text-muted">@thisDay.DayOfWeek</small>
          <span class="col-1"></span>
        </h5>
          @foreach (var vent in ViewBag.Events)
          {
              if(vent.ScheduledAt.Date == thisDay.Date){
                
                <p class="d-sm">@vent.Title</p>
              } else {

                <p class="d-sm-none">No events</p>
              }
          }
          </div>
    } else {
      DateTime thisDay = new DateTime(DateTime.Now.Year, DateTime.Now.Month+1,nextmonth);
      <div
        class="day col-sm p-2 border border-left-0 border-top-0 text-truncate d-none d-sm-inline-block bg-light text-muted">
        <h5 class="row align-items-center">
          <span class="date col-1">@nextmonth</span>
          @{nextmonth++;}
          <small class="col d-sm-none text-center text-muted">@thisDay.DayOfWeek</small>
          <span class="col-1"></span>
        </h5>
          @foreach (var vent in ViewBag.Events)
          {
              if(vent.ScheduledAt.Date == thisDay.Date){
                
                <p class="d-sm">@vent.Title</p>
              } else {

                <p class="d-sm-none">No events</p>
              }
          }
          </div>
        
    }
        
    }
        </div>
    
  }
<table class="table mt-5">
    <thead>
        <tr>
            <th scope="col">Title</th>
            <th scope="col">Date and Time</th>
            <th scope="col">Duration</th>
            <th scope="col">Creator</th>
            <th scope="col">Number of Participants</th>
            <th scope="col">Actions</th>
            <th scope="col">Manage Reminders</th>
        </tr>
    </thead>
    <tbody>
        @{
        
            if(ViewBag.Events != null){
            foreach (Event vent in ViewBag.Events)
            {
              if(vent.ScheduledAt > DateTime.Now){
                <tr>
                    <td><a href="event/@vent.EventId">@vent.Title</a></td>
                    <td>@vent.ScheduledAt.ToString("MMM dd, yyyy h:mm tt")</td>
                    <td>@vent.Duration @vent.HoursOrDays</td>
                    <td>@vent.Creator.FirstName</td>
                    <td></td>
                @if (vent.Creator.UserId == ViewBag.me.UserId)
            
                {
                    <td><a href="/delete/@vent.EventId">Delete</a></td>
                }
                else if (vent.Guests.Any(id => id.UserId == ViewBag.me.UserId)){
                    <td><a href="/join/@vent.EventId">Join</a></td>
                }
                  <td><a href="/reminder/@vent.EventId">Manage</a></td>
                </tr>
              }
        }
            }
            foreach (Link vent in ViewBag.JoinedEvent)
            {
              if(vent.Event.ScheduledAt > DateTime.Now){
                <tr>
                    <td><a href="event/@vent.EventId">@vent.Event.Title</a></td>
                    <td>@vent.Event.ScheduledAt.ToString("MMM dd, yyyy h:mm tt")</td>
                    <td>@vent.Event.Duration @vent.Event.HoursOrDays</td>
                    <td>@vent.Event.Creator.FirstName</td>
                    <td></td>
                @if (vent.Event.Creator.UserId == ViewBag.me.UserId)
            
                {
                    <td><a href="/delete/@vent.EventId">Delete</a></td>
                }
                else if (vent.Event.Guests.Any(id => id.UserId == ViewBag.me.UserId)){
                    <td><a href="event/leave/@vent.Event.EventId">Leave</a></td>
                } else if (vent.Event.Guests.Any(id => id.UserId != ViewBag.me.UserId)){
                    <td><a href="event/join/@vent.Event.EventId">Join</a></td>
                }
                  <td><a href="/reminder/@vent.EventId">Manage</a></td>
                </tr>
              }
        }
        }
    </tbody>
</table>
